{
  "hash": "8c774c7a26631ed5e42573760a518d72",
  "result": {
    "markdown": "---\ntitle: Enhancing gather() and spread() by Using \"Bundled\" data.frames\nauthor: Hiroaki Yutani\ndate: '2019-02-03'\nslug: enhancing-gather-and-spread-by-using-bundled-data-frames\ncategories:\n  - tidyr\n  - tidy data\nformat:\n  html:\n    toc: true\n    toc-title: \"Contents\"\n    toc-location: left\n---\n\n```{=html}\n<style>\ntable {\n  width: 50%;\n  font-size: 80%;\n}\n</style>\n```\n\nLast month, I tried to explain `gather()` and `spread()` by gt package (<https://yutani.rbind.io/post/gather-and-spread-explained-by-gt/>). But, after I implemented experimental multi-`gather()` and multi-`spread()`, I realized that I need a bit different way of explanation... So, please forget the post, and read this with fresh eyes!\n\n## Wait, what is multi-`gather()` and multi-`spread()`??\n\nIn short, the current `gather()` and `spread()` have a limitation; they can gather into or spread from only one column at once. So, if we want to handle multiple columns, we need to coerce them to one column before actually gathering or spreading.\n\nThis is especially problematic when the columns have different types. For example, `date` column is unexpectedly converted to integers with the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tibble)\nlibrary(tidyr)\n\n# a bit different version of https://github.com/tidyverse/tidyr/issues/149#issue-124411755\nd <- tribble(\n  ~place, ~censor,                  ~date, ~status,\n    \"g1\",    \"c1\",  as.Date(\"2019-02-01\"),   \"ok\",\n    \"g1\",    \"c2\",  as.Date(\"2019-02-01\"),  \"bad\",\n    \"g1\",    \"c3\",  as.Date(\"2019-02-01\"),   \"ok\",\n    \"g2\",    \"c1\",  as.Date(\"2019-02-01\"),  \"bad\",\n    \"g2\",    \"c2\",  as.Date(\"2019-02-02\"),   \"ok\"\n)\n\nd %>%\n  gather(key = element, value = value, date, status) %>%\n  unite(thing, place, element, remove = TRUE) %>%\n  spread(thing, value, convert = TRUE)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: attributes are not identical across measure variables;\nthey will be dropped\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 5\n  censor g1_date g1_status g2_date g2_status\n  <chr>    <int> <chr>       <int> <chr>    \n1 c1       17928 ok          17928 bad      \n2 c2       17928 bad         17929 ok       \n3 c3       17928 ok             NA <NA>     \n```\n:::\n:::\n\n\nHere, we need better `spread()` and `gather()`, which can handle multiple columns. For more discussions, you can read the following issues:\n\n-   <https://github.com/tidyverse/tidyr/issues/149>\n-   <https://github.com/tidyverse/tidyr/issues/150>\n\nIn this post, I'm trying to explain an approach to solve this by using \"bundled\" data.frames, which is originally proposed by [Kirill Müller](https://github.com/tidyverse/tidyr/issues/149#issuecomment-452362362).\n\n## \"Bundled\" data.frames\n\nFor convenience, I use a new term \"**bundle**\" for separating some of the columns of a data.frame to another data.frame, and assigning the new data.frame to a column, and \"**unbundle**\" for the opposite operation.\n\nFor example, \"bundling `X`, `Y`, and `Z`\" means converting this\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"cloaiwxgcg\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#cloaiwxgcg .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#cloaiwxgcg .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#cloaiwxgcg .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#cloaiwxgcg .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#cloaiwxgcg .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#cloaiwxgcg .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#cloaiwxgcg .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#cloaiwxgcg .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cloaiwxgcg .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#cloaiwxgcg .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#cloaiwxgcg .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#cloaiwxgcg .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#cloaiwxgcg .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cloaiwxgcg .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#cloaiwxgcg .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#cloaiwxgcg .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cloaiwxgcg .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#cloaiwxgcg .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cloaiwxgcg .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#cloaiwxgcg .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cloaiwxgcg .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#cloaiwxgcg .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#cloaiwxgcg .gt_left {\n  text-align: left;\n}\n\n#cloaiwxgcg .gt_center {\n  text-align: center;\n}\n\n#cloaiwxgcg .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#cloaiwxgcg .gt_font_normal {\n  font-weight: normal;\n}\n\n#cloaiwxgcg .gt_font_bold {\n  font-weight: bold;\n}\n\n#cloaiwxgcg .gt_font_italic {\n  font-style: italic;\n}\n\n#cloaiwxgcg .gt_super {\n  font-size: 65%;\n}\n\n#cloaiwxgcg .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#cloaiwxgcg .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#cloaiwxgcg .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#cloaiwxgcg .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#cloaiwxgcg .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#cloaiwxgcg .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">X</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">Y</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\">Z</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0.1</td>\n<td class=\"gt_row gt_left\">a</td>\n<td class=\"gt_row gt_center\">TRUE</td></tr>\n    <tr><td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">0.2</td>\n<td class=\"gt_row gt_left\">b</td>\n<td class=\"gt_row gt_center\">FALSE</td></tr>\n    <tr><td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">0.3</td>\n<td class=\"gt_row gt_left\">c</td>\n<td class=\"gt_row gt_center\">TRUE</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nto something like this:\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"ysabnjvkbj\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#ysabnjvkbj .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ysabnjvkbj .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ysabnjvkbj .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ysabnjvkbj .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ysabnjvkbj .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ysabnjvkbj .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ysabnjvkbj .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ysabnjvkbj .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ysabnjvkbj .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ysabnjvkbj .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ysabnjvkbj .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ysabnjvkbj .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ysabnjvkbj .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysabnjvkbj .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ysabnjvkbj .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ysabnjvkbj .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysabnjvkbj .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ysabnjvkbj .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysabnjvkbj .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ysabnjvkbj .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysabnjvkbj .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ysabnjvkbj .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ysabnjvkbj .gt_left {\n  text-align: left;\n}\n\n#ysabnjvkbj .gt_center {\n  text-align: center;\n}\n\n#ysabnjvkbj .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ysabnjvkbj .gt_font_normal {\n  font-weight: normal;\n}\n\n#ysabnjvkbj .gt_font_bold {\n  font-weight: bold;\n}\n\n#ysabnjvkbj .gt_font_italic {\n  font-style: italic;\n}\n\n#ysabnjvkbj .gt_super {\n  font-size: 65%;\n}\n\n#ysabnjvkbj .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#ysabnjvkbj .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#ysabnjvkbj .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ysabnjvkbj .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#ysabnjvkbj .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#ysabnjvkbj .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\">id</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\">\n        <span class=\"gt_column_spanner\">foo</span>\n      </th>\n    </tr>\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">X</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">Y</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\">Z</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_right\">1</td>\n<td class=\"gt_row gt_right\">0.1</td>\n<td class=\"gt_row gt_left\">a</td>\n<td class=\"gt_row gt_center\">TRUE</td></tr>\n    <tr><td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">0.2</td>\n<td class=\"gt_row gt_left\">b</td>\n<td class=\"gt_row gt_center\">FALSE</td></tr>\n    <tr><td class=\"gt_row gt_right\">3</td>\n<td class=\"gt_row gt_right\">0.3</td>\n<td class=\"gt_row gt_left\">c</td>\n<td class=\"gt_row gt_center\">TRUE</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nYou might wonder if this is really possible without dangerous hacks. But, with tibble package ([2D columns are supported now](https://www.tidyverse.org/articles/2019/01/tibble-2.0.1/#2d-columns)), this is as easy as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  id = 1:3,\n  foo = tibble(\n    X = 1:3 * 0.1,\n    Y = letters[1:3],\n    Z = c(TRUE, FALSE, TRUE)\n  )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n     id foo$X $Y    $Z   \n  <int> <dbl> <chr> <lgl>\n1     1   0.1 a     TRUE \n2     2   0.2 b     FALSE\n3     3   0.3 c     TRUE \n```\n:::\n:::\n\n\nFor more information about data.frame columns, please see [Advanced R](https://adv-r.hadley.nz/vectors-chap.html#matrix-and-data-frame-columns).\n\n## An experimental package for this\n\nI created a package for bundling, **tiedr**. Since this is just an experiment, I don't seriously introduce this. But, for convenience, let me use this package in this post because, otherwise, the code would be a bit long and hard to read...\n\n<https://github.com/yutannihilation/tiedr>\n\nI need four functions from this package, `bundle()`, `unbundle()`, `gather_bundles()`, and `spread_bundles()`. `gather_bundles()` and `spread_bundles()` are some kind of the variants of `gather()` and `spread()`, so probably you can guess the usages. Here, I just explain about the first two functions briefly.\n\n### `bundle()`\n\n`bundle()` bundles columns. It takes data, and the specifications of bundles in the form of `new_col1 = c(col1, col2, ...), new_col2 = c(col3, col4, ...), ...`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tiedr)\n\nd <- tibble(id = 1:3, X = 1:3 * 0.1, Y = letters[1:3], Z = c(TRUE, FALSE, TRUE))\n\nbundle(d, foo = X:Z)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n     id foo$X $Y    $Z   \n  <int> <dbl> <chr> <lgl>\n1     1   0.1 a     TRUE \n2     2   0.2 b     FALSE\n3     3   0.3 c     TRUE \n```\n:::\n:::\n\n\n`bundle()` also can rename the sub-columns at the same time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbundle(d, foo = c(x = X, y = Y, z = Z))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n     id foo$x $y    $z   \n  <int> <dbl> <chr> <lgl>\n1     1   0.1 a     TRUE \n2     2   0.2 b     FALSE\n3     3   0.3 c     TRUE \n```\n:::\n:::\n\n\n### `unbundle()`\n\n`unbundle()` unbundles columns. This operation is almost the opposite of what `bundle()` does; one difference is that this adds the names of the bundle as prefixes in order to avoid name collisions. In case the prefix is not needed, we can use `sep = NULL`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>%\n  bundle(foo = X:Z) %>% \n  unbundle(foo)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n     id foo_X foo_Y foo_Z\n  <int> <dbl> <chr> <lgl>\n1     1   0.1 a     TRUE \n2     2   0.2 b     FALSE\n3     3   0.3 c     TRUE \n```\n:::\n:::\n\n\n## Expose hidden structures in colnames as bundles\n\nOne of the meaningful usage of bundled data.frame is to express the structure of a data. Suppose we have this data (from [tidyverse/tidyr#150](https://github.com/tidyverse/tidyr/issues/150#issuecomment-168829613)):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- tribble(\n  ~Race,~Female_LoTR,~Male_LoTR,~Female_TT,~Male_TT,~Female_RoTK,~Male_RoTK,\n  \"Elf\",        1229,       971,       331,     513,         183,       510,\n  \"Hobbit\",       14,      3644,         0,    2463,           2,      2673,\n  \"Man\",           0,      1995,       401,    3589,         268,      2459\n)\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"ywaqifzdal\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#ywaqifzdal .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ywaqifzdal .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ywaqifzdal .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ywaqifzdal .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ywaqifzdal .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ywaqifzdal .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ywaqifzdal .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ywaqifzdal .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ywaqifzdal .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ywaqifzdal .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ywaqifzdal .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ywaqifzdal .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ywaqifzdal .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ywaqifzdal .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ywaqifzdal .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ywaqifzdal .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ywaqifzdal .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ywaqifzdal .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ywaqifzdal .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ywaqifzdal .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ywaqifzdal .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ywaqifzdal .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ywaqifzdal .gt_left {\n  text-align: left;\n}\n\n#ywaqifzdal .gt_center {\n  text-align: center;\n}\n\n#ywaqifzdal .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ywaqifzdal .gt_font_normal {\n  font-weight: normal;\n}\n\n#ywaqifzdal .gt_font_bold {\n  font-weight: bold;\n}\n\n#ywaqifzdal .gt_font_italic {\n  font-style: italic;\n}\n\n#ywaqifzdal .gt_super {\n  font-size: 65%;\n}\n\n#ywaqifzdal .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#ywaqifzdal .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#ywaqifzdal .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ywaqifzdal .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#ywaqifzdal .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#ywaqifzdal .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">Race</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Female_LoTR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Male_LoTR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Female_TT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Male_TT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Female_RoTK</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">Male_RoTK</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_left\">Elf</td>\n<td class=\"gt_row gt_right\">1229</td>\n<td class=\"gt_row gt_right\">971</td>\n<td class=\"gt_row gt_right\">331</td>\n<td class=\"gt_row gt_right\">513</td>\n<td class=\"gt_row gt_right\">183</td>\n<td class=\"gt_row gt_right\">510</td></tr>\n    <tr><td class=\"gt_row gt_left\">Hobbit</td>\n<td class=\"gt_row gt_right\">14</td>\n<td class=\"gt_row gt_right\">3644</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">2463</td>\n<td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">2673</td></tr>\n    <tr><td class=\"gt_row gt_left\">Man</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">1995</td>\n<td class=\"gt_row gt_right\">401</td>\n<td class=\"gt_row gt_right\">3589</td>\n<td class=\"gt_row gt_right\">268</td>\n<td class=\"gt_row gt_right\">2459</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nIn this data, the prefixes `Female_` and `Male_` represent the column groups. Thus, as [Kirill Müller suggests in the comment](https://github.com/tidyverse/tidyr/issues/150#issuecomment-452366429), these columns can be bundled (with the sub-columns renamed) to:\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"kulzuxidxn\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#kulzuxidxn .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#kulzuxidxn .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#kulzuxidxn .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#kulzuxidxn .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#kulzuxidxn .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#kulzuxidxn .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#kulzuxidxn .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#kulzuxidxn .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#kulzuxidxn .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#kulzuxidxn .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#kulzuxidxn .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#kulzuxidxn .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#kulzuxidxn .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kulzuxidxn .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#kulzuxidxn .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#kulzuxidxn .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kulzuxidxn .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#kulzuxidxn .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kulzuxidxn .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#kulzuxidxn .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kulzuxidxn .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#kulzuxidxn .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#kulzuxidxn .gt_left {\n  text-align: left;\n}\n\n#kulzuxidxn .gt_center {\n  text-align: center;\n}\n\n#kulzuxidxn .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#kulzuxidxn .gt_font_normal {\n  font-weight: normal;\n}\n\n#kulzuxidxn .gt_font_bold {\n  font-weight: bold;\n}\n\n#kulzuxidxn .gt_font_italic {\n  font-style: italic;\n}\n\n#kulzuxidxn .gt_super {\n  font-size: 65%;\n}\n\n#kulzuxidxn .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#kulzuxidxn .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#kulzuxidxn .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#kulzuxidxn .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#kulzuxidxn .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#kulzuxidxn .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\">Race</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" style=\"color: #414487; font-weight: bold;\">\n        <span class=\"gt_column_spanner\">Female</span>\n      </th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"3\" style=\"color: #7AD151; font-weight: bold;\">\n        <span class=\"gt_column_spanner\">Male</span>\n      </th>\n    </tr>\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">LoTR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">TT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">RoTK</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">LoTR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">TT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">RoTK</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_left\">Elf</td>\n<td class=\"gt_row gt_right\">1229</td>\n<td class=\"gt_row gt_right\">331</td>\n<td class=\"gt_row gt_right\">183</td>\n<td class=\"gt_row gt_right\">971</td>\n<td class=\"gt_row gt_right\">513</td>\n<td class=\"gt_row gt_right\">510</td></tr>\n    <tr><td class=\"gt_row gt_left\">Hobbit</td>\n<td class=\"gt_row gt_right\">14</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">2</td>\n<td class=\"gt_row gt_right\">3644</td>\n<td class=\"gt_row gt_right\">2463</td>\n<td class=\"gt_row gt_right\">2673</td></tr>\n    <tr><td class=\"gt_row gt_left\">Man</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">401</td>\n<td class=\"gt_row gt_right\">268</td>\n<td class=\"gt_row gt_right\">1995</td>\n<td class=\"gt_row gt_right\">3589</td>\n<td class=\"gt_row gt_right\">2459</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nWith `bundle()` we can write this as:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_bundled <- d %>% \n  bundle(\n    Female = c(LoTR = Female_LoTR, TT = Female_TT, RoTK = Female_RoTK),\n    Male   = c(LoTR = Male_LoTR,   TT = Male_TT,   RoTK = Male_RoTK)\n  )\n\nd_bundled\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  Race   Female$LoTR   $TT $RoTK Male$LoTR   $TT $RoTK\n  <chr>        <dbl> <dbl> <dbl>     <dbl> <dbl> <dbl>\n1 Elf           1229   331   183       971   513   510\n2 Hobbit          14     0     2      3644  2463  2673\n3 Man              0   401   268      1995  3589  2459\n```\n:::\n:::\n\n\n## `gather()` the bundles\n\nRemember `gather()` strips colnames and convert it to a column. We can do this operation for bundled data.frames in the same manner. But, unlike `gather()` for flat data.frames, we don't need to specify a colname for values, because the contents in bundles already have their colnames.\n\nLet's gather `Female` and `Male` bundles into `key` column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_gathered <- d_bundled %>%\n  gather_bundles(Female, Male, .key = \"key\")\n\nd_gathered\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  Race   key     LoTR    TT  RoTK\n  <chr>  <chr>  <dbl> <dbl> <dbl>\n1 Elf    Female  1229   331   183\n2 Hobbit Female    14     0     2\n3 Man    Female     0   401   268\n4 Elf    Male     971   513   510\n5 Hobbit Male    3644  2463  2673\n6 Man    Male    1995  3589  2459\n```\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"qwvjctsfos\" style=\"overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>html {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;\n}\n\n#qwvjctsfos .gt_table {\n  display: table;\n  border-collapse: collapse;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qwvjctsfos .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 0;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qwvjctsfos .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qwvjctsfos .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qwvjctsfos .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qwvjctsfos .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qwvjctsfos .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qwvjctsfos .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qwvjctsfos .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qwvjctsfos .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qwvjctsfos .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qwvjctsfos .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qwvjctsfos .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwvjctsfos .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qwvjctsfos .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qwvjctsfos .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwvjctsfos .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qwvjctsfos .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwvjctsfos .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qwvjctsfos .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-left: 4px;\n  padding-right: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwvjctsfos .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qwvjctsfos .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qwvjctsfos .gt_left {\n  text-align: left;\n}\n\n#qwvjctsfos .gt_center {\n  text-align: center;\n}\n\n#qwvjctsfos .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qwvjctsfos .gt_font_normal {\n  font-weight: normal;\n}\n\n#qwvjctsfos .gt_font_bold {\n  font-weight: bold;\n}\n\n#qwvjctsfos .gt_font_italic {\n  font-style: italic;\n}\n\n#qwvjctsfos .gt_super {\n  font-size: 65%;\n}\n\n#qwvjctsfos .gt_two_val_uncert {\n  display: inline-block;\n  line-height: 1em;\n  text-align: right;\n  font-size: 60%;\n  vertical-align: -0.25em;\n  margin-left: 0.1em;\n}\n\n#qwvjctsfos .gt_footnote_marks {\n  font-style: italic;\n  font-weight: normal;\n  font-size: 75%;\n  vertical-align: 0.4em;\n}\n\n#qwvjctsfos .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qwvjctsfos .gt_slash_mark {\n  font-size: 0.7em;\n  line-height: 0.7em;\n  vertical-align: 0.15em;\n}\n\n#qwvjctsfos .gt_fraction_numerator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: 0.45em;\n}\n\n#qwvjctsfos .gt_fraction_denominator {\n  font-size: 0.6em;\n  line-height: 0.6em;\n  vertical-align: -0.05em;\n}\n</style>\n<table class=\"gt_table\">\n  \n  <thead class=\"gt_col_headings\">\n    <tr>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">Race</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\">key</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">LoTR</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">TT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\">RoTK</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td class=\"gt_row gt_left\">Elf</td>\n<td class=\"gt_row gt_left\" style=\"color: #414487; font-weight: bold;\">Female</td>\n<td class=\"gt_row gt_right\">1229</td>\n<td class=\"gt_row gt_right\">331</td>\n<td class=\"gt_row gt_right\">183</td></tr>\n    <tr><td class=\"gt_row gt_left\">Hobbit</td>\n<td class=\"gt_row gt_left\" style=\"color: #414487; font-weight: bold;\">Female</td>\n<td class=\"gt_row gt_right\">14</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">2</td></tr>\n    <tr><td class=\"gt_row gt_left\">Man</td>\n<td class=\"gt_row gt_left\" style=\"color: #414487; font-weight: bold;\">Female</td>\n<td class=\"gt_row gt_right\">0</td>\n<td class=\"gt_row gt_right\">401</td>\n<td class=\"gt_row gt_right\">268</td></tr>\n    <tr><td class=\"gt_row gt_left\">Elf</td>\n<td class=\"gt_row gt_left\" style=\"color: #7AD151; font-weight: bold;\">Male</td>\n<td class=\"gt_row gt_right\">971</td>\n<td class=\"gt_row gt_right\">513</td>\n<td class=\"gt_row gt_right\">510</td></tr>\n    <tr><td class=\"gt_row gt_left\">Hobbit</td>\n<td class=\"gt_row gt_left\" style=\"color: #7AD151; font-weight: bold;\">Male</td>\n<td class=\"gt_row gt_right\">3644</td>\n<td class=\"gt_row gt_right\">2463</td>\n<td class=\"gt_row gt_right\">2673</td></tr>\n    <tr><td class=\"gt_row gt_left\">Man</td>\n<td class=\"gt_row gt_left\" style=\"color: #7AD151; font-weight: bold;\">Male</td>\n<td class=\"gt_row gt_right\">1995</td>\n<td class=\"gt_row gt_right\">3589</td>\n<td class=\"gt_row gt_right\">2459</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\nNow we have all parts for implementing multi-`gather()`. I did bundling by manual, but we can have a helper function to find the common prefixes and bundle them automatically. So, multi-`gather()` will be something like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd %>%\n  auto_bundle(-Race) %>% \n  gather_bundles()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  Race   key     LoTR    TT  RoTK\n  <chr>  <chr>  <dbl> <dbl> <dbl>\n1 Elf    Female  1229   331   183\n2 Hobbit Female    14     0     2\n3 Man    Female     0   401   268\n4 Elf    Male     971   513   510\n5 Hobbit Male    3644  2463  2673\n6 Man    Male    1995  3589  2459\n```\n:::\n:::\n\n\n![](./images/2019-02-03-multi-gather.jpg)\n\n## `spread()` to the bundles\n\nAs we already saw it's possible to `gather()` multiple bundles, now it's obvious that we can `spread()` multiple columns into multiple bundles vice versa. So, let me skip the details here.\n\nWe can multi-`spread()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_bundled_again <- d_gathered %>%\n  spread_bundles(key, LoTR:RoTK)\n\nd_bundled_again\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 3\n  Race   Female$LoTR   $TT $RoTK Male$LoTR   $TT $RoTK\n  <chr>        <dbl> <dbl> <dbl>     <dbl> <dbl> <dbl>\n1 Elf           1229   331   183       971   513   510\n2 Hobbit          14     0     2      3644  2463  2673\n3 Man              0   401   268      1995  3589  2459\n```\n:::\n:::\n\n\nThen, `unbundle()` flattens the bundles to prefixes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_bundled_again %>%\n  unbundle(-Race)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 7\n  Race   Female_LoTR Female_TT Female_RoTK Male_LoTR Male_TT Male_RoTK\n  <chr>        <dbl>     <dbl>       <dbl>     <dbl>   <dbl>     <dbl>\n1 Elf           1229       331         183       971     513       510\n2 Hobbit          14         0           2      3644    2463      2673\n3 Man              0       401         268      1995    3589      2459\n```\n:::\n:::\n\n\nIt's done. By combining these two steps, multi-`spread()` will be something like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_gathered %>%\n  spread_bundles(key, LoTR:RoTK) %>% \n  unbundle(-Race)\n```\n:::\n\n\n## Considerations\n\nAs I described above, multi-`gather()` doesn't need the column name for `value`. On the other hand, usual `gather()` needs a new colname. Because, while it needs a name to become a column, an atomic column doesn't have inner names.\n\nSimilarly, usual `spread()` can be considered as a special version of multi-`spread()`. Consider the case when we multi-`spread()`ing one column:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# an example in ?tidyr::spread\ndf <- tibble(x = c(\"a\", \"b\"), y = c(3, 4), z = c(5, 6))\n\nspread_bundles(df, key = x, y, simplify = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n      z   a$y   b$y\n  <dbl> <dbl> <dbl>\n1     5     3    NA\n2     6    NA     4\n```\n:::\n:::\n\n\nSince `y` is the only one column in the data, we can simplify these 1-column data.frames to vectors:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspread_bundles(df, key = x, y, simplify = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 3\n      z     a     b\n  <dbl> <dbl> <dbl>\n1     5     3    NA\n2     6    NA     4\n```\n:::\n:::\n\n\nThis is usual `spread()`.\n\nI'm yet to see if we can improve the current `spread()` and `gather()` to handle these differences transparently...\n\n## Future plans\n\nProbably, this post is too much about the implementational details. I need to think about the interfaces before proposing this on tidyr's repo.\n\nAny suggestions or feedbacks are welcome!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}